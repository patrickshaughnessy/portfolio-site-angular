'use strict';

angular
  .module('app')
  .controller('blogCtrl', function($timeout, $scope, $location, $anchorScroll){
    $scope.posts = posts;

    $timeout(function(){
      $scope.loaded = true;
    }, 1500)

    $scope.goToPost = function(id) {
       $location.hash(id);
       $anchorScroll();
    }

  });
var posts = [{"title":"Integrating A Blog On A Static Site Built With Angular And Angular UI Router","id":"Integrating_A_Blog_On_A_Static_Site_Built_With_Angular_And_Angular UI_Router","date":"01-15-2016","tags":["blog","Angular","Javascript"],"body":"<p>There are a ton of open source blog generators for devs out there: Ghost, Hexo, Jekyll, Wintersmith, Metalsmith (<a href=\"http://sixrevisions.com/tools/open-source-blogging-platforms-for-developers/\" title=\"Open Source Blogging Platforms For Developers\">this post</a> has a nice write-up on a few). But when I set out to make my personal site, I ran into a glaring problem with all of them.</p>\n<p>The goal was to make a little portfolio site - a landing page, a page to showcase and link to my work, and an integrated blog. Pretty simple, right? I thought so too, until I started playing around with these tools. After much frustration and tinkering, I realized that none of them had a simple, out-of-the-box solution to create different pages or views. Apparently, you can either have a blog or a site, but you can&#39;t have both.</p>\n<p>Well, that just wasn&#39;t going to work for me =).</p>\n<h3 id=\"if-it-doesn-t-exist-make-it\">If It Doesn&#39;t Exist, Make It</h3>\n<p>I knew what I needed to do, so it was just a matter of putting the pieces together correctly in order to make it work. Initially, I tried messing around with <a href=\"https://hexo.io/\" title=\"Hexo\">Hexo</a>. But even after diving into the config settings, I couldn&#39;t find a way to generate even a simple home page without the blog.</p>\n<p>Then I thought <a href=\"http://www.metalsmith.io/\" title=\"metalsmith\">metalsmith</a> was going to work out. You basically make a build file that compiles all your files into a nice little static package. Unfortunately, the learning curve was a bit too steep on this one and I could never quite get past the most basic of basic tutorials (although <a href=\"https://azurelogic.com/posts/building-a-blog-with-metalsmith/\" title=\"Building a blog with Metalsmith\">this tutorial by Rob Ribeiro</a> was super helpful and at least got me started).</p>\n<p>By this point, I realized I needed to do one of two things. Either find a way to:</p>\n<ol>\n<li>Generate my views with one of these blog generators, <em>OR</em></li>\n<li>Compile the markdown to HTML and inject it into my site before deploying.</li>\n</ol>\n<p>I was out of ideas on option 1, so it was on to option 2.</p>\n<h3 id=\"the-setup\">The Setup</h3>\n<p>You can find all the code for this on <a href=\"https://github.com/patrickshaughnessy/Example-Portfolio-Site-With-Blog\" title=\"my github repo\">my github repo</a>. Feel free to clone it down and follow along or use it as a template.</p>\n<p>Basically I started with a pretty simple setup - just angular and angular-ui-router to handle my views and bootstrap for styling. Theres a &#39;posts&#39; folder with a few markdown files, but they&#39;re not showing up in our blog just yet.</p>\n<p>What we need to do is take those markdown files, preserve the front matter as data, render the body to HTML, and make it available to our angular app. In other words, we need a build script. In your terminal:</p>\n<pre><code>touch build.js\n</code></pre><h3 id=\"node-time-\">Node Time!</h3>\n<p>We&#39;ll need a few dependencies to make our build script run properly, so let&#39;s add those now. Do an</p>\n<pre><code>npm init\n</code></pre><p>and follow the prompts to initialize a package.json file in your directory. For this project, we&#39;ll need to parse our markdown and concat some files together, so:</p>\n<pre><code>npm i -S concat-files markdown-parse\n</code></pre><p>Ok now we&#39;re ready to make our build script!</p>\n<h3 id=\"the-build\">The Build</h3>\n<p>Let&#39;s start out by requiring our dependencies. In your build.js:</p>\n<pre><code>&#39;use strict&#39;;\n\nvar concat = require(&#39;concat-files&#39;);\nvar parser = require(&#39;markdown-parse&#39;);\nvar fs = require(&#39;fs&#39;);\nvar path = require(&#39;path&#39;);\n</code></pre><p>Great! Now the first thing we want to do is grab all those markdown files from our posts directory so they&#39;re available to the parser. Then we&#39;ll want to iterate over each one, creating a new post object that we can use in our angular app later.</p>\n<pre><code>fs.readdir(&#39;./posts/&#39;, function(err, files){\n    if (err) throw err;\n    var posts = [];\n    files.forEach(function(file){\n        var content = (fs.readFileSync(__dirname + `/posts/${file}`, &#39;utf8&#39;));\n\n    parser(content, function(err, result){\n        var newPost = {};\n        newPost.title = result.attributes.title;\n        newPost.id = result.attributes.id;\n        newPost.date = result.attributes.date;\n        newPost.tags = result.attributes.tags || [];\n        newPost.body = result.html.toString();\n\n        posts.push(newPost);\n    })\n});\n</code></pre><p>It&#39;s worth noting here that this gives you complete control over the data you make available to your blog component. Here I&#39;ve only included things like the title, date, and tags. But you could easily expand this to include just about any meta data you want.</p>\n<p>Next, we&#39;ll write a temporary file to hold the posts data. We can assign it to a variable &#39;data&#39; to make it available to our angular app later.</p>\n<pre><code>var data = `var posts = ${JSON.stringify(posts)}`\nfs.writeFileSync(&#39;./posts.js&#39;, data);\n</code></pre><p>And finally, let&#39;s combine our blog component controller with our newly minted post data. We should also remove that temporary posts file to keep our directory nice and clean.</p>\n<pre><code>concat([\n    &#39;./controllers/blogCtrl.js&#39;,\n    &#39;./posts.js&#39;\n], path.resolve(__dirname, &#39;./controllers/blogCtrlCompiled.js&#39;), function(err){\n    if (err) throw err\n    console.log(&#39;All posts compiled successfully!&#39;);\n    fs.unlinkSync(&#39;./posts.js&#39;)\n});\n</code></pre><p>Now we can run our build.js file in node, and it will create a new file called blogCtrlCompiled.js in our controllers directory. If you take a peek inside that compiled controller file you&#39;ll see that our data has been added to the bottom and is now accessible to the controller.</p>\n<h3 id=\"setting-up-the-blog-component\">Setting Up The Blog Component</h3>\n<p>With the tricky part of injecting our posts into the app finished, we can move on to getting the blog set up and styled to our liking. I find a custom directive helpful in this situation. We can set it up once, and then just ng-repeat over each post and populate them automatically.</p>\n<p>So in our templates/blog.html, let&#39;s change the &#39;posts go here&#39; to:</p>\n<pre><code>&lt;div class=&quot;col-xs-12&quot; ng-repeat=&quot;post in posts&quot;&gt;\n    &lt;blog-post info={{post}}&gt;&lt;/blog-post&gt;\n&lt;/div&gt;\n</code></pre><p>And create a blogPost directive - blogPost.js</p>\n<pre><code>&#39;use strict&#39;;\n\nangular.module(&#39;app&#39;).directive(&#39;blogPost&#39;, blogPost);\n\nfunction blogPost() {\n    return {\n        restrict: &quot;AE&quot;,\n        templateUrl: &quot;directives/blogPost.html&quot;,\n        scope: {\n            info: &quot;@&quot;\n        },\n        controller: function($scope) {\n            &#39;use strict&#39;;\n            $scope.post = JSON.parse($scope.info);\n        }\n    };\n};\n</code></pre><p>and our template html - blogPost.html</p>\n<pre><code>&lt;h1 class=&quot;postTitle&quot; id={{post.id}}&gt;{{post.title}}&lt;/h1&gt;\n&lt;h6 class=&quot;postDate&quot;&gt;{{post.date}}&lt;/h6&gt;\n&lt;div ng-bind-html=&quot;post.body&quot;&gt;&lt;/div&gt;\n</code></pre><p>Note that ng-bind-html requires the angular $sanitize service to be available to your app. You&#39;ll need to add the cdn link in a script to your index.html and inject it in the app.js file as well. Of course, don&#39;t forget to link up your new directive in your index.html too.</p>\n<p>And that&#39;s about it! Just run build.js before serving it up on localhost or deploying to gh-pages or wherever.</p>\n<h3 id=\"final-thoughts\">Final Thoughts</h3>\n<p>At first I was overwhelmed at the thought of making my own blog component. Plenty of people who&#39;ve been doing this longer than I have made all these cool blog generating tools - it&#39;s probably really hard. And it was totally frustrating at first digging through the config files on each of them, trying to figure out how they worked. But a little persistence goes a long way, and I&#39;m super satisfied with the way it turned out. Now I&#39;ve got a fully integrated blog on a single-page static site, and I can customize it however I want without worrying about messing up some &#39;magic&#39; buried in some node module somewhere in the npm package.</p>\n<p>What do you think? Any ideas on how I can improve this thing or did you do it a different way? Let me know!</p>\n"},{"title":"Title 1","id":"title_1","date":"MM-DD-YYYY","tags":["cool","Angular","Javascript"],"body":"<h3 id=\"test-post-1\">Test Post 1</h3>\n<p>Cow meatloaf tongue spare ribs kevin turducken. Porchetta ball tip sausage turkey beef ribs beef andouille short loin. Prosciutto leberkas pork chop alcatra, pork belly rump fatback short loin ham pancetta ribeye turkey salami. Rump picanha short loin bacon pig beef. Jowl tri-tip sausage shoulder leberkas pork. Bacon frankfurter landjaeger, boudin kielbasa ham pork salami shankle beef pork loin.</p>\n<p>Short ribs pork chop shoulder hamburger, ribeye shank strip steak landjaeger t-bone. Short ribs fatback swine strip steak short loin pork loin brisket doner tail. Pork loin chicken shoulder filet mignon doner shank. Kevin picanha pork belly pork loin shoulder turducken brisket rump bresaola boudin meatloaf doner swine. Bresaola ham beef ribs jowl cow pork loin sirloin capicola pig. Ham hock meatball short ribs sirloin.</p>\n<p>Cupim chicken bacon fatback rump drumstick leberkas turducken shankle filet mignon. Chuck andouille turkey jerky pork chop shank short ribs shoulder fatback boudin. Kevin t-bone pork chop doner jowl ribeye meatloaf cupim shank spare ribs ball tip pig chuck ground round. Strip steak tongue spare ribs picanha, salami filet mignon bacon landjaeger pancetta capicola beef bresaola pork loin.</p>\n"},{"title":"Title 2","id":"title_2","date":"MM-DD-YYYY","tags":[],"body":"<h3 id=\"test-post-2\">Test Post 2</h3>\n<p>Meatloaf frankfurter strip steak ham short loin. Brisket drumstick rump tail meatball bresaola shoulder boudin pork chicken sirloin cupim doner tongue prosciutto. Beef frankfurter bacon, cow drumstick picanha jowl ribeye biltong. Cow pork chop ham hock pork meatball turducken swine brisket short ribs t-bone strip steak ground round.</p>\n<p>Cow meatloaf tongue spare ribs kevin turducken. Porchetta ball tip sausage turkey beef ribs beef andouille short loin. Prosciutto leberkas pork chop alcatra, pork belly rump fatback short loin ham pancetta ribeye turkey salami. Rump picanha short loin bacon pig beef. Jowl tri-tip sausage shoulder leberkas pork. Bacon frankfurter landjaeger, boudin kielbasa ham pork salami shankle beef pork loin.</p>\n<p>Short ribs pork chop shoulder hamburger, ribeye shank strip steak landjaeger t-bone. Short ribs fatback swine strip steak short loin pork loin brisket doner tail. Pork loin chicken shoulder filet mignon doner shank. Kevin picanha pork belly pork loin shoulder turducken brisket rump bresaola boudin meatloaf doner swine. Bresaola ham beef ribs jowl cow pork loin sirloin capicola pig. Ham hock meatball short ribs sirloin.</p>\n"},{"title":"Title 3","id":"title_3","date":"MM-DD-YYYY","tags":[],"body":"<p>Bacon ipsum dolor amet turducken kielbasa short ribs corned beef swine. Capicola pig venison prosciutto turducken chuck pastrami brisket biltong bacon doner pork chop shankle andouille. Cupim picanha pork andouille turducken rump pork loin short loin beef ribeye boudin pig frankfurter. Frankfurter short loin brisket picanha sausage swine. Fatback cupim pig, sirloin shankle prosciutto filet mignon doner short ribs. Shankle pig filet mignon spare ribs t-bone, flank chicken jerky sausage alcatra pancetta pork belly rump picanha.</p>\n<p>Meatloaf frankfurter strip steak ham short loin. Brisket drumstick rump tail meatball bresaola shoulder boudin pork chicken sirloin cupim doner tongue prosciutto. Beef frankfurter bacon, cow drumstick picanha jowl ribeye biltong. Cow pork chop ham hock pork meatball turducken swine brisket short ribs t-bone strip steak ground round.</p>\n<p>Cow meatloaf tongue spare ribs kevin turducken. Porchetta ball tip sausage turkey beef ribs beef andouille short loin. Prosciutto leberkas pork chop alcatra, pork belly rump fatback short loin ham pancetta ribeye turkey salami. Rump picanha short loin bacon pig beef. Jowl tri-tip sausage shoulder leberkas pork. Bacon frankfurter landjaeger, boudin kielbasa ham pork salami shankle beef pork loin.</p>\n"}]